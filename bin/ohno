#!/usr/bin/python
# coding: utf-8

import sys
import os
import traceback
import bpython

def main():
    BIN_DIR = os.path.dirname(os.path.realpath(__file__))
    ROOT_DIR = os.path.abspath(os.path.join(BIN_DIR, '..'))

    # Not exactly best practice, but convenient enough..
    sys.path.extend([ROOT_DIR, os.path.join(ROOT_DIR, 'lib', 'loglady'), os.path.join(ROOT_DIR, 'lib', 'ansiterm')])
    import ohno.ohno

    try:
        instance = ohno.ohno.Ohno(ROOT_DIR)
        instance.start_resume_game()
        instance.loop()
        # If we're done looping, it means Ohno had a successful shutdown.
    except KeyboardInterrupt:
        instance.logger.ohno('Ctrl+C. Saving game')
        instance.save() # Will call shutdown
    except Exception, e:
        instance.logger.ohno('Got an exception: "%s"' % e)
        # Need to shut down curses before the traceback.
        instance.save() # Will call shutdown
        bpython_locals = {
            'ohno': instance,
            'e': e
        }
        bpython.embed(locals_=bpython_locals)
        traceback.print_exc()

if __name__ == '__main__':
    main()
